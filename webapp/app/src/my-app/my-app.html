<!doctype html>
<!--
@license
Copyright (c) 2015 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->

<link rel="import" href="elements.html">

<dom-module id="my-app">
  <template>
    <style>
      :host {
        --app-primary-color: #4285f4;
        --app-secondary-color: black;
        --app-very-lightgray: #fafafa;
        --app-lightgray: #EEE;
        --app-blue: #1a9fd9;
        display: block;
        font-size: 14px;
        font-weight: 400;
      }

      app-drawer {
         --app-drawer-content-container: {
          background-color: var(--app-lightgray);
         }
       }
      .toolbar {
        background: var(--app-blue);
        color: white;
        height: 56px;
      }

      #toolbarlogo {
        height: 37px;
        background: white;
        padding: 4px;
        padding-left: 11px;
      }

      .drawer-list {
        margin: 0 20px;
        font-size: 14px;
        font-weight: 400;
       }

       .drawer-list a {
         display: block;
         padding: 0 16px;
         text-decoration: none;
         color: black;
         line-height: 40px;
      }

      .drawer-list a.iron-selected {
        color: #3f51b5;
        color: var(--app-blue);
        font-weight: bold;
      }

      .drawer-list a[verborgen] {
        display: none;
      }

      paper-material {
        padding: 16px 16px 16px  16px;
        width: calc(98% - 132px);
        margin: 16px auto 16px auto;
        background: var(--app-lightgray);
      }

    </style>

    <app-location route="{{_ar_route}}" use-hash-as-path></app-location>

    <app-route id="approuter"
      route="{{_ar_route}}"
      pattern="/:page"
      data="{{_ar_route_data}}"
      tail="{{_ar_subroute}}">
    </app-route>

    <app-route
      route="{{_ar_subroute}}"
      pattern="/:subpage"
      data="{{_ar_subroute_data}}"
      tail="{{_ar_subsubroute}}">
    </app-route>

    <app-route
      route="{{_ar_subsubroute}}"
      pattern="/:subsubpage"
      data="{{_ar_subsubroute_data}}">
    </app-route>



    <app-drawer-layout  fullbleed>
 	  <app-drawer id="drawer">
        <app-toolbar class="toolbar">
          <img id="toolbarlogo" src="../../images/hu_logo.png" alt="HU" />
        </app-toolbar>

        <iron-selector selected="[[_ar_page]]" attr-for-selected="name" class="drawer-list" role="navigation">

          <a name="login" title$="Inloggen" href$="[[_c_baseURL]]login"  verborgen$="[[!_are_strings_equal(_rol, 'undefined')]]">
            <iron-icon icon="account-box"></iron-icon>
            <span>Inloggen</span>
          </a>

          <a name="home" title$="Home" href$="[[_c_baseURL]]home" verborgen$="[[_are_strings_equal(_rol, 'undefined')]]">
            <iron-icon icon="home"></iron-icon>
            <span>Home</span>
          </a>

          <a name="systeem_instellen_systeemdatum" title$="Instellen systeemdatum" href$="[[_c_baseURL]]systeem/instellen_systeemdatum" verborgen$="[[_are_strings_equal(_rol, 'undefined')]]">
            <iron-icon icon="icons:today"></iron-icon>
            <span>(test) Instellen systeemdatum</span>
          </a>

          <a name="logout" title$="Uitloggen" href$="[[_c_baseURL]]logout"  verborgen$="[[_are_strings_equal(_rol, 'undefined')]]">
            <iron-icon icon="account-box"></iron-icon>
            <span>Uitloggen</span>
          </a>

          <a name="student_medestudenten" title$="Mede studenten" href$="[[_c_baseURL]]student/medestudenten"  verborgen$="[[!_are_strings_equal(_rol, 'student')]]" verborgen$="[[_are_strings_equal(_rol, 'undefined')]]">
            <iron-icon icon="social:group"></iron-icon>
            <span>Toon medestudenten</span>
          </a>

        </iron-selector>
      </app-drawer>

      <app-toolbar class="toolbar">
        <paper-icon-button  icon="menu" drawer-toggle></paper-icon-button>
        <span>[[_ar_selected_object.title]] ([[_systeemdatumlokaal]])</span>
      </app-toolbar>

      <iron-pages
        attr-for-selected="name"
        selected="[[_ar_page]]"
        selected-item="{{_ar_selected_object}}"
        fallback-selection="view404"
        role="main">

        <section name="login"
                 title="LOGIN"
                 element$="my-login">
          <paper-material elevation="1" style="max-width: 380px;">'
            <my-login username="{{_username}}" rol="{{_rol}}" ></my-login>
          </paper-material>
        </section>

        <section name="home" title="HOME" element$="none">
          <paper-material elevation="1">
              <p>Demo app gebaseerd op Polymer.</p>
              <p>Deze app past nadat je bent ingeloggen het menu aan, aan de rol die gekoppeld is aan de ingeloggede user.</p>

              <h1>[[_ar_page]]</h1>
          </paper-material>
        </section>

        <section name="systeem_instellen_systeemdatum"
                 title="INSTELLEN SYSTEEMDATUM"
              	 element$="my-systeemdatum">
            <paper-material elevation="1">
              <my-systeemdatum
                systeemdatumlokaal="{{_systeemdatumlokaal}}"
                systeemdatumstandaard="{{_systeemdatumstandaard}}"
                c_visible="[[_are_strings_equal(_ar_page, 'systeem_instellen_systeemdatum')]]">
              </my-systeemdatum>
            </paper-material>
          </section>



          <section name="logout"
                   title="UITLOGGEN"
                   element="my-logout">
            <paper-material elevation="1">
              <my-logout rol="{{_rol}}"></my-logout>
            </paper-material>
          </section>

          <section  name="student_medestudenten"
                    title="OVERZICHT MEDESTUDENTEN"
                    element$="my-medestudenten">
            <paper-material elevation="1">
              <my-medestudenten
                c_visible="[[_are_strings_equal(_ar_page, 'student_medestudenten')]]"
                c_rol="[[_rol]]"
                c_username="[[_username]]">
              </my-medestudenten>
            </paper-material>
          </section>

          <section name="student_details" title="STUDENT DETAILS">
            <paper-material elevation="1">
              <h2 class="page-title">Student: [[_ar_subsubroute_data.subsubpage]]</h2>
              <div>This is [[_ar_subsubroute_data.subsubpage]]'s section</div>
            </paper-material>
          </section>

          <section  name="view404"
                    title="PAGE NOT FOUND"
                    element$="my-view404">
            <paper-material elevation="1">
              <my-view404></my-view404>
            </paper-material>
          </section>
        </iron-pages>
    </app-drawer-layout>

   </template>
  <script>
    (function() {
      'use strict';

      Polymer({
        is: 'my-app',

        properties: {
          _c_baseURL: {
            type: String,
            value: "/#/",
          },
          _rol: {
            type: String,
            value: "undefined",
          },
          _ar_page: {
            type: String,
            reflectToAttribute: true,
            value: "",
          },
          _ar_route: {
            type: Object,
          },
          _ar_route_data: {
            type: Object,
          },
          _ar_selected_object: {
            type: Object,

            observer: '_ar_selected_object_changed',
          },
          _ar_subroute: {
            type: Object,
          },
          _ar_subroute_data: {
            type: Object,
          },
          _ar_subsubroute: {
            type: Object,
          },
          _ar_subsubroute_data: {
              type: Object,
          },
         _systeemdatumlokaal: {
            type: String,
          },
          _systeemdatumstandaard: {
            type: String,
          },
          _username: {
            type: String,
          },
        },

        observers: [
          '_ar_route_data_page_changed(_ar_route_data.page)',
          '_ar_subroute_data_subpage_changed(_ar_subroute_data.subpage)',
        ],

        _ar_route_data_page_changed: function(pNewPage) {
          if (!this.$.drawer.persistent) {
            this.$.drawer.close();
          }
          if ((pNewPage == "") || (pNewPage == undefined)){
              this._ar_page = "login";
            } else {
              this._ar_page = pNewPage;
            }
        },

         _ar_selected_object_changed: function(pSelectedObject) {
          if (pSelectedObject == undefined) {
            return
          }
          var lAttributeNode = pSelectedObject.attributes["element$"];
          if (lAttributeNode== undefined) {
              return
          }
          var lElementName = lAttributeNode.nodeValue;
          if (lElementName== "none") {
              return
         }
          var resolvedPageUrl = this.resolveUrl("../" + lElementName  + '/' + lElementName + '.html');
          this.importHref(resolvedPageUrl, null, this._ar_showPage404, true);
        },

        _ar_showPage404: function() {
          this._ar_page = 'view404';
        },

        _ar_subroute_data_subpage_changed(pNewSubpage) {
          if ((pNewSubpage == "") || (pNewSubpage == undefined)){
          } else {
            this._ar_page =this._ar_route_data.page + "_" + pNewSubpage;
          }
        },

	    _are_strings_equal: function(p_str1, p_str2) {
	      return (p_str1==p_str2);
	    },

	    ready: function()  {
		  var eenDatumObject             = new Date(); // is vandaag
		  this._systeemdatumstandaard    = this.date_to_standaard_string(eenDatumObject);
		  this._systeemdatumlokaal       = eenDatumObject.toLocaleDateString();
		  console.log("application ready to run");
        },

	    date_to_standaard_string: function(p_JSDate) {
	      var lJaar = p_JSDate.getFullYear();
          var lMaand= p_JSDate.getMonth() + 1;
          var lDag = p_JSDate.getDate();

          var lMaandStr = lMaand.toString();
          if (lMaandStr.length == 1) {
            lMaandStr = "0"+ lMaandStr;
          }
          var lDagStr = lDag.toString();
          if (lDagStr.length == 1) {
            lDagStr = "0"+ lDagStr;
          }
          var lString =
            lJaar.toString() + "-" +
            lMaandStr + "-" +
            lDagStr;
          return lString;
        },

	    standaarddatumstring_to_lokaledatumstring: function(p_standaarddatumstring) {
	      var lokaledatumstring = "";
	      if (p_standaarddatumstring !="") {
	        var eenDatumObject = new Date(p_standaarddatumstring);
	        lokaledatumstring = eenDatumObject.toLocaleDateString();
	      }
	      return lokaledatumstring;
        },

      });

    })();
  </script>

</dom-module>
