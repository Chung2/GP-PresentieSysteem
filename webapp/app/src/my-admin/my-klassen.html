<link rel="import" href="../../elements/elements.html">
<link rel="import" href="../../bower_components/paper-button/paper-button.html">

<dom-module id="my-klassen">
  <link rel="import" type="css" href="../../styles/mainStyle.css">
  <template>
    <a id="redirect_login" href="#/login"></a>
    <a id="redirect_home" href="#/home"></a>

    <iron-ajax
        id="ajax_klassen"
        method="POST"
        url="/klassen/info"
        handle-as="json"
        on-response="ajax_klassen_handler">
    </iron-ajax>

    <div>
      <template is="dom-repeat" items="{{klassen}}">
        <h1>{{item.naam}}</h1>
        Klascode: {{item.klasCode}}<br>
        Aantal studenten: {{item.deStudenten.length}}
        <br><br>

        <paper-card class="holder" elevation="2">

          <brainy-table items="[[item.deStudenten]]" page-size="[[item.deStudenten.length]]" details-enabled>
            <brainy-table-column name="Voornaam" sort-by="item.voornaam" width="35px">
              <template>[[item.voornaam]]</template>
            </brainy-table-column>

            <brainy-table-column name="Tussenvoegsel" width="45px">
              <template>[[item.tussenvoegsel]]</template>
            </brainy-table-column>

            <brainy-table-column name="Achternaam" width="45px">
              <template>[[item.achternaam]]</template>
            </brainy-table-column>

            <brainy-table-column name="E-mail" width="150px">
              <template>[[item.gebruikersnaam]]</template>
            </brainy-table-column>

            <brainy-table-column name="StudentNr" width="30px">
              <template>[[item.studentNummer]]</template>
            </brainy-table-column>

            <brainy-table-column name="Ziek" width="30px">
              <template>[[item.ziek]]</template>
            </brainy-table-column>

            <brainy-table-column width="30px" align-right flex="0">
              <template>
                <template is="dom-if" if="[[!expanded]]">
                  <iron-icon icon="icons:expand-more"></iron-icon>
                </template>
                <template is="dom-if" if="[[expanded]]">
                  <iron-icon icon="icons:expand-less"></iron-icon>
                </template>
              </template>
            </brainy-table-column>

             <template is="row-detail" style="padding: 5px;">
               <div>
                 <paper-button class="red" on-tap="ajax_zet_status_onClick">Afwezig melden</paper-button>
                 <paper-button class="green" on-tap="ajax_beter_melden_onClick">Aanwezig melden</paper-button>
               </div>
             </template>

             <div no-results>No records found</div>
          </brainy-table>

        </paper-card>

      </template>
    </div>


  </template>

  <script>

      Polymer({

        is: 'my-klassen',

        properties: {
          gebruiker:{
            type: Object
          }
        },

        ajax_klassen_start: function(){
          this.$.ajax_klassen.contentType="application/json";
          this.$.ajax_klassen.body={
          };

            this.$.ajax_klassen.generateRequest();
        },

        ajax_klassen_handler: function(request){

          this.klassen = request.detail.response;

        },

        update: function() {
          //Ingelogde gebruiker ophalen
          this.gebruiker = JSON.parse(localStorage.getItem("gebruiker"));

          //Als gebruiker niet is ingelogd terug sturen naar login scherm
          if(this.gebruiker == null) {
            this.$.redirect_login.click();

            return;
          }

          //Admin naar admin scherm toe sturen
          if(this.gebruiker.rol =! 'admin'){
            this.$.redirect_home.click();

            return;
          }

          this.ajax_klassen_start();
          console.log(this.deStudenten);
        },
      })

  </script>

</dom-module>
